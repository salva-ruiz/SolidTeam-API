#!/usr/bin/env node

const knex = require('knex')
const connection = require('../db/config.json')
const client = knex({
  client: 'pg',
  connection
})

client.schema
  .createTable('users', function(t) {
    t.increments()
    t.string('user_name', 64).notNullable()
    t.string('full_name', 100).notNullable()
    t.string('email_address', 100).notNullable()
    t.string('time_zone', 100).notNullable()
    t.timestamps(true, true)
    t.unique('user_name')
    t.unique('email_address')
    t.index('created_at')
  })
  .createTable('accounts', function(t) {
    t.increments()
    t.integer('owner_id').notNullable().references('users')
    t.string('account_name', 64).notNullable()
    t.timestamps(true, true)
    t.unique(['owner_id', 'account_name'])
    t.index('owner_id')
  })
  .createTable('teams', function(t) {
    t.increments()
    t.integer('account_id').notNullable().references('accounts')
    t.string('team_name', 64).notNullable()
    t.timestamps(true, true)
    t.unique(['account_id', 'team_name'])
    t.index('account_id')
    t.index('team_name')
  })
  .createTable('team_members', function(t) {
    t.integer('team_id').notNullable().references('teams')
    t.integer('user_id').notNullable().references('users')
    t.primary(['team_id', 'user_id'])
  })
  .debug()
  .then( () => { 
    client.destroy()
  })
